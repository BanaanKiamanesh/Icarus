## Dynamics and Kinematics of a Quadcopter

A quadcopter is a type of unmanned aerial vehicle (UAV) that uses four rotors to generate lift and control its motion. The dynamics and kinematics of a quadcopter can be described using the principles of Newtonian mechanics and rigid body dynamics.

### Kinematics

The relation between the angular velocity of the quadcopter and the roll, pitch, and yaw angles can be expressed using the following equation:

$$ \omega = \begin{bmatrix} 1 & 0 & -\sin\theta \\ 0 & \cos\phi & \cos\theta \sin\phi \\ 0 & -\sin\phi & \cos\theta \cos\phi \end{bmatrix} ^ {-1} \begin{bmatrix} \dot{\phi} \\  \dot{\theta} \\ \dot{\psi} \end{bmatrix} \\ \bm{\Downarrow} \\ \omega = \begin{bmatrix} 1 & \sin\phi \tan\theta & \cos\phi \tan\theta \\ 0 & \cos\phi & -\sin\phi \\ 0 & \frac{\sin\phi}{\cos\theta} & \frac{\cos\phi}{\cos\theta} \end{bmatrix} \begin{bmatrix} \dot{\phi} \\ \dot{\theta} \\ \dot{\psi} \end{bmatrix} $$

where:

- $\phi$, $\theta$, and $\psi$ are the roll, pitch, and yaw angles, respectively
- $\omega$ is the angular velocity of the quadcopter

The relation between the translational velocity of the quadcopter and the roll, pitch, and yaw angles can be expressed using the following equation:

$$ \begin{bmatrix} \dot{x} \\ \dot{y} \\ \dot{z} \end{bmatrix} = R(\phi, \theta, \psi) \begin{bmatrix} u \\ v \\ w \end{bmatrix}$$

where:

- $\dot{x}$, $\dot{y}$, and $\dot{z}$ are the translational velocities of the quadcopter in the inertial frame
- $u$, $v$, and $w$ are the velocities of the quadcopter in the body frame
- $R(\phi, \theta, \psi)$ is the ZYX rotation matrix corresponding to the roll, pitch, and yaw angles

### Dynamics

The motion of a quadcopter can be described using six degrees of freedom: three translational (surge, sway, heave) and three rotational (roll, pitch, yaw). The forces and moments acting on the quadcopter can be modeled using the following equations:

#### Translational motion

There are three forces acting on the quadcopter:

1. the gravitational force
2. the thrust generated by the rotors
3. the drag force.

The gravitational force is always directed downwards, while the thrust and drag forces are directed along the body axes of the quadcopter. The thrust and drag forces are functions of the angular velocity of the rotors, which is controlled by the flight controller. Using the Newton's equations, the translational motion of the quadcopter can be described by the following equations:

$$\begin{bmatrix} \ddot{x} \\ \ddot{y} \\ \ddot{z} \end{bmatrix} = \begin{bmatrix} 0 \\ 0 \\ -g \end{bmatrix} + \frac{1}{m} R(\phi,\theta,\psi) \begin{bmatrix} 0 \\ 0 \\ T_{\Sigma} \end{bmatrix} + \frac{1}{m} F_{D} $$

where:

- $m$ is the mass of the quadcopter
- $g$ is the gravitational acceleration
- $x$, $y$, and $z$ are the positions of the quadcopter in the inertial frame
- $\phi$, $\theta$, and $\psi$ are the roll, pitch, and yaw angles, respectively
- $R(\phi,\theta,\psi)$ is the rotation matrix corresponding to the roll, pitch, and yaw angles
- $T_{\Sigma}$ is the total thrust generated by the four rotors

The drag force is usually modelled as a function of the translational velocity of the quadcopter:

$$ F_{D} = \begin{bmatrix} -D_{x} \dot{x}  \\ - D_{y} \dot{y} \\ - D_{z} \dot{z} \end{bmatrix}$$

where $D_{x}$, $D_{y}$, and $D_{z}$ are the drag coefficients in the $x$, $y$, and $z$ directions, respectively.

#### Rotational motion

Euler's equation for rotatinal motion:

$$ I \dot{\omega} + \omega \times (I\omega) = \tau \\
\bm{\Rightarrow} \dot{\omega} = \begin{bmatrix} \dot\omega_{x}  \\ \dot\omega_{y} \\ \dot\omega_{z} \end{bmatrix} = I^{-1} (\tau - \omega \times (I\omega)) $$

where:

- $I$ is the moment of inertia matrix
- $\omega$ is the angular velocity of the quadcopter
- $\tau$ is the total moment acting on the quadcopter

assuming that the quadcopter is symmetric about the $x$ and $y$ axes, the moment of inertia matrix will be diagonal and can be expressed as:

$$ I = \begin{bmatrix} I_{xx} & 0 & 0 \\ 0 & I_{yy} & 0 \\ 0 & 0 & I_{zz} \end{bmatrix} $$

where $I_{xx}$, $I_{yy}$, and $I_{zz}$ are the moments of inertia about the $x$, $y$, and $z$ axes, respectively. The quadcopter can be modelled as two thin rods of length $l$ connected at the center. The moment of inertia about the $x$ and $y$ axes can be expressed as:

$$ I_{xx} = I_{yy} = \frac{1}{12} m l^{2} $$

The moment of inertia about the $z$ axis can be expressed as:

$$ I_{zz} = \frac{1}{2} m l^{2} $$

or they can be derived using system identification techniques.

> **Note:** For the sake of simplicity the angular motion of the quadcopter is expressed in the body frame, translational motion are expressed in the inertial frame.

### Torque and thrust

Each motor generates a thrust and a torque. The thrust is directed along the $z$ axis of the body frame, while the torque is directed along the $x$ and $y$ axes of the body frame. Thrust force of each motor is modelled as a function of the square of the angular velocity of the motor:

$$ T_{i} = k \omega_{i}^{2} $$

where $k$ is a constant that depends on the propeller and motor characteristics.

Torque on each $x$, $y$ and $z$ axes are modelled as:

$$ \tau = \begin{bmatrix} \tau_{x}  \\ \tau_{y} \\ \tau_{z} \end{bmatrix} = \begin{bmatrix} l k (\omega_{2}^{2} - \omega_{4}^{2})  \\ l k (\omega_{3}^{2} - \omega_{1}^{2}) \\ b (\omega_{1}^{2} - \omega_{2}^{2} + \omega_{3}^{2} - \omega_{4}^{2}) \end{bmatrix} $$

The total thrust and torque generated by the rotors can be expressed as a single matrix equation:

$$ \begin{bmatrix} T_{\Sigma} \\ \tau_{x} \\ \tau_{y} \\ \tau_{z} \end{bmatrix} = \begin{bmatrix} k & k & k & k \\ 0 & -l k & 0 & l k \\ -l k & 0 & l k & 0 \\ b & -b & b & -b \end{bmatrix} \begin{bmatrix} \omega_{1}^{2} \\ \omega_{2}^{2} \\ \omega_{3}^{2} \\ \omega_{4}^{2} \end{bmatrix} $$

where:

- $k$ is a constant that depends on the propeller and motor characteristics
- $l$ is the distance between the center of the quadcopter and the center of each rotor
- $b$ is a constant that depends on the propeller and motor characteristics
- $\omega_{1}$, $\omega_{2}$, $\omega_{3}$, and $\omega_{4}$ are the angular velocities of the four rotors

The euqations of motion describing each motor can be expressed as:

$$ \dot{\omega}_{i} = \begin{cases} P_{up} (\omega_{des} - \omega_{i}) & \text{for } \omega_{des} > \omega_{i} \\ P_{down}(\omega_{des} - \omega_{i}) & \text{otherwise.} \end{cases} $$

where:

- $P_{up}$ and $P_{down}$ are the motor dynamics constants
- $\omega_{des}$ is the desired angular velocity of the motor

Motors are faster to speed up than to slow down. To model this, we can define a $P_{up} \geq P_{down}$. To bypass motor dynamics, we may set $\omega_{des_{1..4}} = \omega_{i_{1..4}} $. To ignore motor saturation, we may set $\omega_{max} = -\omega_{min} = \infty$.

### References

- [Peter Corke, Robotics, Vision and Control: Fundamental Algorithms in MATLAB](http://www.petercorke.com/RVC/)
- [Mahony R., Kumar V., Corke P., Multirotor Aerial Vehicles: Modeling, Estimation, and Control of Quadrotor](http://ieeexplore.ieee.org/xpl/articleDetails.jsp?arnumber=6289431)
- [Lupashin S., Hehn, M., Mueller, M.W., Schoellig, A.P., Sherback, M., D’Andrea, R, “A platform for aerial robotics research and demonstration: The Flying Machine Arena”](https://www.flyingmachinearena.ethz.ch/wp-content/publications/2014/lupashin2014platform.pdf)
